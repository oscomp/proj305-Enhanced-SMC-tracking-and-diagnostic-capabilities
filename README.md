# proj305-Enhanced-SMC-tracking-and-diagnostic-capabilities
# 共享内存通信协议栈 SMC 跟踪诊断能力增强

## 项目描述

共享内存通信协议栈 Shared Memory Communication (SMC) 是一种基于共享内存技术（RDMA 等）、兼容 socket 接口的 Linux 内核网络协议，由 IBM 提出并在 2017 年贡献至 Linux 内核，协议规范定义在 [IETF RFC 7609](https://datatracker.ietf.org/doc/html/rfc7609)。SMC 使用 RDMA 等新技术，透明加速 TCP 网络应用程序，获得更高的带宽、更低的时延，以及更低的资源消耗的网络协议。

近些年，在来自龙蜥社区等众多开发者的参与下，SMC 逐步从面向传统小规模 RDMA 应用场景，扩展到支持更多设备、适配云原生场景的更加现代的协议栈。稳定性、短连接性能得到了显著的提升，SMC 透明加速 Redis 等场景对比 TCP 具有 50% 以上的 QPS 提升，本地回环通信对比 TCP 具有数倍的吞吐提升。

新技术如何在工业界大规模部署和使用，除了需要考虑自身的收益外，还要综合考虑迁移和运维成本。SMC 作为一个面向生产大规模部署使用的协议栈，对比 TCP 具备更高的性能，但是在跟踪诊断能力上，即运维成本，对比生态繁荣的 TCP 协议还有比较大的差距：TCP 协议栈具备从底层硬件（网卡）到各层协议，具有完整的监控指标、跟踪和采集分析工具，而 SMC 无论是覆盖广度和深度都有比较大的差距。

综上，本项目期望能够帮助 SMC 解决最为常见的时延问题，提供所需的两个跟踪诊断指标和工具，即连接和消息级别的时延跟踪，和对应的数据包抓取工具，帮助发现并识别时延问题。

## 预期目标

1. 设计时延跟踪和分析工具，应具备连接级别的时延监控指标，以及消息级别的时延跟踪、数据包的抓取和分析工具；
2. 开发完成内核代码、用户态工具和 eBPF 工具（如有）；
3. 设计、讨论和开发过程中应当有完备的文档，代码具有完备的测试，针对用户有相应的使用手册；
4. 开源所提交的代码，参与 Linux 等上游社区的讨论，并贡献至开源社区；

## 特征

1. 提供连接级别的常态化、低开销的粗粒度时延指标，记录当前 SMC 协议栈中时延异常的数据包耗时，反映当前连接的数据包处理的时延情况；
2. 设计时延跟踪和分析工具，能够准确识别和分析用户态程序发送数据、SMC 协议栈处理协议包、通过硬件等发送、对端硬件接收、SMC 协议栈处理和用户态程序收到数据包等各个阶段的时间戳，以及相应的数据报文内容、接受发送方 IP、端口等元信息，支持存储到本地文件。根据 1 中提供的指标定位所需跟踪的连接，通过 2 中的工具找到具体的数据包，和数据包阻塞的阶段；
3. 开发完成 SMC 内核代码，增加所需的指标、tracepoint、procfs 或者 netlink 接口，新增接口的注解应体现在文档或手册汇总，应具备完备的测试；
4. 开发相应的用户态工具，建议使用 eBPF 技术，并集成至 smc-tools 中，应具备完整的测试、设计文档和使用手册；

## 已有参考资料

- [IETF RFC 7609](https://datatracker.ietf.org/doc/html/rfc7609)
- [SMC 协议白皮书](https://www.ibm.com/support/pages/ibm-shared-memory-communications-version-2)
- [SMC 原理解读](https://openanolis.cn/sig/high-perf-network/doc/735934905968200546)

## 赛题分类

内核完善

## 参赛要求

- 以小组为单位参赛，最多三人一个小组，且小组成员是来自同一所高校的本科生或研究生
- 允许学生参加大赛的多个不同题目，最终自己选择一个题目参与评奖
- 请遵循“2024全国大学生操作系统比赛”的章程和技术方案要求

## 难度

中等

## License

GPL-2.0 License

## 所属赛道

2024全国大学生操作系统比赛的“OS功能挑战”赛道

## 项目导师

- 姓名：李靖轩、陆扬
- 单位：阿里云
- Email：[dust.li@linux.alibaba.com](mailto:dust.li@linux.alibaba.com)、[tonylu@linux.alibaba.com](mailto:tonylu@linux.alibaba.com)
